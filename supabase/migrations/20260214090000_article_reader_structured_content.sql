alter table public.explore_articles
  add column if not exists content jsonb,
  add column if not exists sources text;

update public.explore_articles
set content = jsonb_build_object(
  'sections', jsonb_build_array(jsonb_build_object('type', 'body', 'text', body)),
  'sources', coalesce(sources, 'Erikson Â· Gerber/RIE Â· Harvard CCHD Â· Diamond')
)
where content is null;

update public.explore_articles
set sources = coalesce(sources, content->>'sources', 'Erikson Â· Gerber/RIE Â· Harvard CCHD Â· Diamond')
where sources is null;

with articles as (
  select * from (values
    (
      'âœŠ', 'Por quÃ© el â€œnoâ€ es una gran noticia para {childName}', 'research', 'AutonomÃ­a', 5, 12, 24,
      'Cada â€œnoâ€ estÃ¡ construyendo identidad y autocontrol.',
      '{"sections":[{"type":"body","text":"Cuando {childName} dice no, su cerebro estÃ¡ practicando agencia, no rebeldÃ­a."},{"type":"pull_quote","emoji":"ðŸ’¡","text":"Cada \"no\" es una declaraciÃ³n de identidad: \"yo tambiÃ©n tengo voz\"."},{"type":"section_header","text":"La ciencia detrÃ¡s"},{"type":"science_callout","title":"Erikson + funciones ejecutivas","text":"Entre 12 y 24 meses, afirmar preferencias fortalece autonomÃ­a, base de la autorregulaciÃ³n futura."},{"type":"numbered_insight","number":1,"title":"Valida antes de redirigir","text":"\"Escucho tu no\" baja tensiÃ³n y abre cooperaciÃ³n."},{"type":"numbered_insight","number":2,"title":"Ofrece dos opciones","text":"Da control dentro de lÃ­mites seguros."},{"type":"try_this","text":"Hoy, cuando diga no, pausa 5 segundos y ofrece dos caminos concretos."},{"type":"warm_tip","emoji":"ðŸ’›","text":"Tu calma le enseÃ±a que puede disentir sin perder conexiÃ³n."}],"sources":"Erikson Â· Gerber/RIE Â· Diamond"}'
    ),
    ('ðŸ§º','Transportar tesoros: por quÃ© {childName} mueve todo por la casa','article','Play schemas',4,12,24,'Transportar objetos es pensamiento cientÃ­fico en acciÃ³n.','{"sections":[{"type":"body","text":"Si {childName} llena y vacÃ­a bolsas, no estÃ¡ desordenando: estÃ¡ estudiando peso, volumen y propÃ³sito."},{"type":"section_header","text":"QuÃ© estÃ¡ descubriendo"},{"type":"body","text":"El schema de transporting conecta memoria de trabajo, planificaciÃ³n y causa-efecto."},{"type":"try_this","text":"Deja una cesta con objetos seguros de distintos tamaÃ±os y observa su lÃ³gica."},{"type":"warm_tip","emoji":"ðŸŒŸ","text":"Tu observaciÃ³n atenta convierte caos aparente en aprendizaje visible."}],"sources":"Athey Play Schemas Â· Piaget"}'),
    ('ðŸŒ€','La fascinaciÃ³n por girar: cerebro en modo laboratorio','research','Sensorimotor',4,12,24,'Girar, repetir y mirar fortalece predicciÃ³n y atenciÃ³n.','{"sections":[{"type":"body","text":"Cuando {childName} gira tapas o ruedas, estÃ¡ buscando patrones estables en un mundo cambiante."},{"type":"science_callout","title":"PredicciÃ³n y curiosidad","text":"El marco PACE explica cÃ³mo pequeÃ±as sorpresas disparan exploraciÃ³n y aprendizaje."},{"type":"try_this","text":"Ofrece coladores, tapas y ruedas de juguete para comparar giros rÃ¡pidos y lentos."}],"sources":"PACE Framework Â· Piaget"}'),
    ('ðŸ“¦','Dentro y fuera: el poder del schema de enclosure','guide','Cognitivo',4,12,24,'Meter y sacar objetos construye lÃ³gica espacial.','{"sections":[{"type":"body","text":"{childName} aprende que los objetos pueden contener y ser contenidos: base del pensamiento matemÃ¡tico temprano."},{"type":"numbered_insight","number":1,"title":"Recipientes variados","text":"Cajas, tazas y bowls cambian la dificultad."},{"type":"numbered_insight","number":2,"title":"Nombra relaciones","text":"\"Dentro\", \"fuera\", \"lleno\", \"vacÃ­o\" enriquecen lenguaje."},{"type":"warm_tip","text":"No necesitas juguetes caros: cocina y reciclaje alcanzan."}],"sources":"Athey Â· Vygotsky"}'),
    ('ðŸ§ ','Rabietas y cerebro inmaduro: una lectura compasiva','research','Socioemocional',6,14,24,'La desregulaciÃ³n no es manipulaciÃ³n: es desarrollo en curso.','{"sections":[{"type":"body","text":"Cuando {childName} explota, su sistema de freno aÃºn estÃ¡ madurando."},{"type":"pull_quote","emoji":"ðŸ¤²","text":"La co-regulaciÃ³n hoy se vuelve autorregulaciÃ³n maÃ±ana."},{"type":"science_callout","title":"Funciones ejecutivas","text":"InhibiciÃ³n y flexibilidad cognitiva crecen con apoyo sensible repetido."},{"type":"try_this","text":"Habla poco, respira lento y ofrece contenciÃ³n fÃ­sica si la acepta."}],"sources":"Diamond Â· Harvard CCHD"}'),
    ('ðŸ—£ï¸','Primeras palabras, gran revoluciÃ³n mental','article','Lenguaje',5,12,24,'Comprende mucho mÃ¡s de lo que puede decir.','{"sections":[{"type":"body","text":"{childName} estÃ¡ construyendo un diccionario interno enorme antes de hablar fluido."},{"type":"numbered_insight","number":1,"title":"Turnos conversacionales","text":"Pausa para que responda con gesto, sonido o mirada."},{"type":"numbered_insight","number":2,"title":"Nombra lo que le interesa","text":"El vocabulario pega mejor cuando nace de su foco."},{"type":"warm_tip","emoji":"ðŸ’¬","text":"Tu voz cÃ¡lida es herramienta de neurodesarrollo."}],"sources":"Harvard CCHD Â· Hidi & Renninger"}'),
    ('ðŸ«§','RepeticiÃ³n infinita: por quÃ© hacer lo mismo sÃ­ importa','guide','Aprendizaje',4,12,24,'Repetir consolida redes neuronales y confianza.','{"sections":[{"type":"body","text":"Cuando {childName} repite una acciÃ³n, estÃ¡ afinando precisiÃ³n y predicciÃ³n."},{"type":"science_callout","title":"PrÃ¡ctica + cerebro","text":"La repeticiÃ³n con pequeÃ±as variaciones acelera automatizaciÃ³n y flexibilidad."},{"type":"try_this","text":"Permite 10 repeticiones antes de proponer algo nuevo."}],"sources":"Piaget Â· Diamond"}'),
    ('ðŸ¤','Serve & Return en la vida real: micro-momentos que transforman','guide','VÃ­nculo',5,12,24,'Responder a sus seÃ±ales fortalece lenguaje y apego seguro.','{"sections":[{"type":"section_header","text":"El ciclo de 5 pasos"},{"type":"numbered_insight","number":1,"title":"Observa la seÃ±al","text":"Mirada, gesto, sonido o movimiento."},{"type":"numbered_insight","number":2,"title":"Responde con calidez","text":"Sigue su foco antes de dirigir."},{"type":"numbered_insight","number":3,"title":"Espera su vuelta","text":"La pausa crea conversaciÃ³n."},{"type":"warm_tip","text":"Tu presencia atenta es ciencia aplicada."}],"sources":"Harvard CCHD Serve & Return"}'),
    ('ðŸŽ¯','AutonomÃ­a sin caos: lÃ­mites que sÃ­ funcionan','guide','AutonomÃ­a',5,12,24,'LÃ­mites claros + elecciÃ³n reducen luchas de poder.','{"sections":[{"type":"body","text":"{childName} necesita estructura para sentirse seguro y opciones para sentirse capaz."},{"type":"numbered_insight","number":1,"title":"Una regla, dos opciones","text":"\"Es hora de salir: Â¿zapatos rojos o azules?\""},{"type":"numbered_insight","number":2,"title":"Anticipa transiciones","text":"Avisos breves previenen choques."},{"type":"warm_tip","emoji":"ðŸŒˆ","text":"Firmeza amable es la combinaciÃ³n ganadora."}],"sources":"Self-Determination Theory Â· RIE"}'),
    ('ðŸ§©','Conectar y desconectar: ingenierÃ­a temprana','article','Play schemas',4,12,24,'Unir piezas entrena pensamiento causal.','{"sections":[{"type":"body","text":"Cuando {childName} conecta bloques, cintas o tapas, estÃ¡ modelando sistemas."},{"type":"science_callout","title":"ZPD","text":"Con una pista mÃ­nima, puede resolver retos mÃ¡s complejos."},{"type":"try_this","text":"Prepara materiales que encajen de varias formas y describe su estrategia."}],"sources":"Vygotsky Â· Athey"}')
  ) as t(emoji,title,type,domain,read_time_minutes,age_min_months,age_max_months,summary,content)
)
insert into public.explore_articles (emoji,title,type,domain,summary,body,read_time_minutes,age_min_months,age_max_months,language,content,sources)
select a.emoji,a.title,a.type,a.domain,a.summary,a.summary,a.read_time_minutes,a.age_min_months,a.age_max_months,'es',a.content::jsonb, (a.content::jsonb->>'sources')
from articles a
where not exists (
  select 1 from public.explore_articles e where lower(e.title)=lower(a.title) and e.language='es'
);
